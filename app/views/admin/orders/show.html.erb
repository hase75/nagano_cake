<h1>注文履歴詳細</h1>

<div>
  <h4>購入者</h4>
  <%= @order.customer.full_name %>
  <h4>注文日</h4>
  <%= @order.created_at %>
  <h4>配送先</h4>
  <%= @order.address %>
  <h4>支払方法</h4>
  <%= @order.payment_method_i18n %>
  <h4>注文ステータス</h4>
  <%= form_with model: @order, url:admin_order_path, method: :PATCH do |f| %>
    <%= f.select :status, [['入金待ち'], ['入金確認'], ['製作中'], ['発送準備中'], ['発送済み']] %>
    <%= f.submit '変更' %>
  <% end %>
</div>

<div>
  <table>
    <thead>
      <th>商品名</th>
      <th>単価(税込)</th>
      <th>数量</th>
      <th>小計</th>
      <th>製作ステータス</th>
    </thead>
    <tbody>
      <% @order_detail.each do |order_detail| %>
        <tr>
          <td><%= order_detail.item.name %></td>
          <td><%= order_detail.item.with_tax_price %></td>
          <td><%= order_detail.amount %></td>
          <td><%= order_detail.subtotal %></td>
          <td><%= form_with model: order_detail, url:admin_order_detail_path, method: :PATCH do |f| %>
              <%= f.select :making_status, [['製作不可'], ['製作待ち'], ['製作中'], ['製作完了']] %>
              <%= f.submit '変更' %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>


<div>
  <table>
    <thead>
      <th>商品合計</th>
      <th>配送料</th>
      <th>請求情報</th>
    </thead>
    <tbody>
      <tr>
        <td><%= @order.order_details.sum(&:subtotal) %></td>
        <td><%= @order.shipping_cost %></td>
        <td><%= @order.total_payment %></td>
      </tr>
    </tbody>
  </table>
</div>
